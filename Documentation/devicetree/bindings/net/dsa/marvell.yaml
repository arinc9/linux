# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/net/dsa/marvell.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Marvell Ethernet Switches

$ref: dsa.yaml#/$defs/ethernet-ports

maintainers:
  - Andrew Lunn <andrew@lunn.ch>
  - Arınç ÜNAL <arinc.unal@arinc9.com>

description:
  Marvell ethernet switches are MDIO devices.

properties:
  compatible:
    description:
      The compatibility string is used only to find an identification register,
      which is at a different MDIO base address in different switch families.
    oneOf:
      - description: |
          Switch has base address 0x10. Use with models:
          6085, 6095, 6097, 6123, 6131, 6141, 6161, 6165, 6171, 6172, 6175,
          6176, 6185, 6240, 6320, 6321, 6341, 6350, 6351, 6352
        const: marvell,mv88e6085

      - description: |
          Switch has base address 0x00. Use with models:
          6190, 6190X, 6191, 6191X, 6290, 6361, 6390, 6390X, 6393X
        const: marvell,mv88e6190

      - description: |
          Switch has base address 0x08 or 0x18. Use with models:
          6220, 6250
        const: marvell,mv88e6250

  reg:
    maxItems: 1

  reset-gpios:
    description: GPIO to be used to reset the whole device
    maxItems: 1

  "#interrupt-cells":
    const: 2

  interrupt-controller: true

  interrupts:
    maxItems: 1

  eeprom-length:
    description:
      Set to the length of an EEPROM connected to the switch. Must be set if the
      switch can not detect the presence and/or size of a connected EEPROM,
      otherwise optional.

  mdio:
    description:
      The optional node for the MDIO bus of the switch. The bus will be
      registered non-OF-based if this is not defined.
    $ref: /schemas/net/mdio.yaml#
    unevaluatedProperties: false

required:
  - compatible
  - reg

allOf:
  - if:
      properties:
        compatible:
          const: marvell,mv88e6190
    then:
      properties:
        mdio-external:
          description:
            The externally reachable MDIO bus of the 6390 family switches.
          $ref: /schemas/net/mdio.yaml#
          unevaluatedProperties: false

          properties:
            compatible:
              const: marvell,mv88e6xxx-mdio-external

          required:
            - compatible

  - if:
      required: [ mdio ]
    then:
      patternProperties:
        "^(ethernet-)?ports$":
          patternProperties:
            "^(ethernet-)?port@[0-9]+$":
              $ref: /schemas/net/ethernet-controller.yaml#/$defs/phylink

unevaluatedProperties: false

examples:
  - |
    #include <dt-bindings/gpio/gpio.h>

    mdio {
        #address-cells = <1>;
        #size-cells = <0>;

        switch@0 {
            compatible = "marvell,mv88e6085";
            reg = <0>;
            reset-gpios = <&gpio5 1 GPIO_ACTIVE_LOW>;

            ethernet-ports {
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    phy-mode = "rmii";
                    ethernet = <&fec1>;

                    fixed-link {
                        speed = <100>;
                        full-duplex;
                    };
                };

                port@1 {
                    reg = <1>;
                    label = "swp1";
                };
            };
        };
    };

  - |
    #include <dt-bindings/gpio/gpio.h>
    #include <dt-bindings/interrupt-controller/irq.h>

    mdio {
        #address-cells = <1>;
        #size-cells = <0>;

        switch: switch@0 {
            compatible = "marvell,mv88e6190";
            reg = <0>;
            reset-gpios = <&gpio5 1 GPIO_ACTIVE_LOW>;
            interrupt-parent = <&gpio3>;
            interrupts = <2 IRQ_TYPE_LEVEL_LOW>;
            interrupt-controller;
            #interrupt-cells = <2>;

            ethernet-ports {
                #address-cells = <1>;
                #size-cells = <0>;

                port@0 {
                    reg = <0>;
                    phy-mode = "rmii";
                    ethernet = <&fec1>;

                    fixed-link {
                        speed = <100>;
                        full-duplex;
                    };
                };

                port@1 {
                    reg = <1>;
                    label = "swp1";
                    phy-handle = <&ethphy1>;
                };

                port@2 {
                    reg = <2>;
                    label = "swp2";
                    phy-handle = <&ext_ethphy0>;
                };
            };

            mdio {
                #address-cells = <1>;
                #size-cells = <0>;

                ethphy1: ethernet-phy@1 {
                    reg = <1>;
                    interrupt-parent = <&switch>;
                    interrupts = <1 IRQ_TYPE_LEVEL_HIGH>;
                };
            };

            mdio-external {
                compatible = "marvell,mv88e6xxx-mdio-external";
                #address-cells = <1>;
                #size-cells = <0>;

                ext_ethphy0: ethernet-phy@0 {
                    reg = <0>;
                    compatible = "ethernet-phy-ieee802.3-c45";
                };
            };
        };
    };
